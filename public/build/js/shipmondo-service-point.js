jQuery(document).ready((function(o){function e(o){return o.parents(".shipmondo_service_point_selection")}function n(o){return e(o).data("selected_service_point")}function i(i){var t=e(i).data("shipping_index"),s=e(i).data("shipping_agent");const d=n(i),a=i.data("service_point");if(d.id!==a.id){var c={id:a.id,name:a.name,address:a.address,zipcode:a.zipcode,city:a.city};!function(o,n){e(o).data("selected_service_point",n)}(i,a),function(e,n,i){o.post(shipmondo.ajax_url,{action:"shipmondo_set_selection_session",selection:e,agent:n,shipping_index:i},(function(o){}))}(c,s,t),function(o,n,i){const t=e(i);t.find('input[name="shipmondo['+o+']"]').val(n.id),t.find('input[name="shop_name['+o+']"]').val(n.name),t.find('input[name="shop_address['+o+']"]').val(n.address),t.find('input[name="shop_zip['+o+']"]').val(n.zipcode),t.find('input[name="shop_city['+o+']"]').val(n.city),t.find(".selected_service_point .name").html(n.name),t.find(".selected_service_point .address_info").html(i.data("address")),t.find(".selected_service_point .distance").html(i.data("distance")),t.find(".service_point.selected").removeClass("selected"),i.addClass("selected")}(t,c,i)}}function t(o){return e(o).find(".shipmondo-dropdown")}function s(o){return e(o).find(".shipmondo-modal")}function d(e){e.removeClass("visible"),o("body").removeClass("shipmondo_modal_open"),setTimeout((function(){o(".shipmondo-modal-checkmark").removeClass("visible"),e.addClass("shipmondo-hidden")}),300)}o(document).on("click",".selected_service_point.selector_type-dropdown",(function(n){n.stopPropagation(),function(o){const n=t(o);var i;o.hasClass("visible")?m(n):((i=n).addClass("visible"),e(i).find(".selected_service_point").addClass("selector_open"))}(t(o(this)))})),o(document).on("click",".shipmondo-original .selected_service_point.selector_type-modal",(function(e){var n;e.stopPropagation(),(n=s(o(e.target))).removeClass("shipmondo-hidden"),function(o){var e;"undefined"==typeof google||void 0===google.maps?(r=o,(e=document.createElement("script")).src="https://maps.googleapis.com/maps/api/js?key="+shipmondo.google_maps_api_key+"&loading=async&callback=googleMapsInit",e.async=!0,document.head.appendChild(e)):p(o.find(".service_points_map"))}(n),setTimeout((function(){o("body").addClass("shipmondo_modal_open"),n.addClass("visible"),n.find(".shipmondo-modal_content").addClass("visible")}),100)})),o(document).on("click",".shipmondo-original .shipmondo-modal_close",(function(e){e.preventDefault(),d(s(o(e.target)))})),o(document).on("click",".shipmondo-original .shipmondo-modal",(function(e){void 0!==e.target&&o(e.target).hasClass("shipmondo-modal")&&d(s(o(e.target)))}));var a=null,c=null,l=null;function p(e){a=new google.maps.Map(e[0],{zoom:6,center:{lat:55.9150835,lng:10.4713954},mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),l=new google.maps.InfoWindow,c=new google.maps.LatLngBounds;const i=e.data("service_points"),t=n(e);o.each(i,(function(o,e){!function(o,e){var n=new google.maps.Marker({position:{lat:parseFloat(o.latitude),lng:parseFloat(o.longitude)},map:a,icon:{url:e.id===o.id?shipmondo.icon_url_selected:shipmondo.icon_url,size:new google.maps.Size(48,48),scaledSize:new google.maps.Size(48,48),anchor:new google.maps.Point(24,24)}});google.maps.event.addListener(n,"click",function(e){return function(){l.setContent("<strong>"+o.company_name+"</strong><br/>"+o.address+"<br/> "+o.city+" <br/> "+o.zipcode+'<br/><div id="shipmondo-button-wrapper"><button class="button" id="shipmondo-select-shop" data-number="'+o.number+'">'+shipmondo.select_shop_text+"</button></div>"),l.open(a,e)}}(n)),c.extend(n.position)}(e,t)})),setTimeout((function(){a.fitBounds(c)}),100)}var r=null;function t(o){return e(o).find(".shipmondo-dropdown_wrapper")}function m(o){o.removeClass("visible"),e(o).find(".selected_service_point").removeClass("selector_open")}o(document).on("googleMapsLoaded",(function(){p(r.find(".service_points_map"))})),o(document).on("click",".shipmondo-original .selector_type-modal .service_points_list .service_point",(function(){i(o(this)),o(".shipmondo-modal_content").removeClass("visible"),o(".shipmondo-modal-checkmark").addClass("visible");const e=s(o(this));setTimeout((function(){d(e)}),1800)})),o(document).on("click",".shipmondo-original #shipmondo-select-shop",(function(n){n.preventDefault(),e(o(this)).find(".service_point[data-id="+o(this).data("number")+"]").trigger("click")})),o(document).on("click",".shipmondo-original .selected_service_point.selector_type-dropdown",(function(e){e.stopPropagation(),toogleDropdown(o(this))})),o(document).on("click",(function(e){var n=o(".shipmondo-original .shipmondo-dropdown_wrapper.visible");n.length>0&&!n.is(e.target)&&0===n.has(e.target).length&&m(n)})),o(document).on("click",".shipmondo-original .selector_type-dropdown .service_points_list .service_point",(function(){i(o(this)),m(t(o(this)))}))})),window.googleMapsInit=function(){jQuery(document).trigger("googleMapsLoaded")};